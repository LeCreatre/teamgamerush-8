<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TEAM City Run</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF4B2B; /* –Ø—Ä–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π */
            --secondary: #2B32B2; /* –ì–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π */
            --ui-bg: rgba(255, 255, 255, 0.9);
            --font-main: 'Rubik', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            overflow: hidden;
            font-family: var(--font-main);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 480px; /* –§–æ—Ä–º–∞—Ç –º–æ–±–∏–ª–∫–∏ */
            background: linear-gradient(180deg, #1488CC, #2B32B2); /* –ù–µ–±–æ */
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* --- UI –°–õ–û–ô --- */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* –°—á–µ—Ç –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã */
        .hud {
            position: absolute;
            top: 40px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-pill {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 18px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* –≠–∫—Ä–∞–Ω—ã –ú–µ–Ω—é */
        .screen {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            padding: 40px 30px;
            border-radius: 30px;
            text-align: center;
            width: 80%;
            max-width: 320px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            pointer-events: auto;
            transform: scale(1);
            transition: opacity 0.3s, transform 0.3s;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .screen.hidden {
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
            display: none; /* –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –∫–ª–∏–∫–∞–º */
        }

        h1 {
            color: var(--secondary);
            font-size: 32px;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: -1px;
            line-height: 1;
        }

        h1 span {
            color: var(--primary);
        }

        p {
            color: #555;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .big-score {
            font-size: 48px;
            color: var(--secondary);
            font-weight: 900;
            margin: 10px 0;
            display: block;
        }

        /* –ö–ù–û–ü–ö–ò */
        .btn {
            background: linear-gradient(45deg, var(--secondary), #4553ff);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(43, 50, 178, 0.4);
            transition: all 0.2s;
            width: 100%;
            font-family: var(--font-main);
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            transform: scale(0.96);
            box-shadow: 0 4px 10px rgba(43, 50, 178, 0.3);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –±–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ */
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        .btn:hover::after {
            left: 100%;
        }

        /* –§—É—Ç–µ—Ä –≤ –º–µ–Ω—é */
        .footer-info {
            margin-top: 20px;
            font-size: 12px;
            color: #888;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ —É–¥–∞—Ä–µ */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

    </style>
</head>
<body>

<div id="game-wrapper">
    <canvas id="gameCanvas"></canvas>

    <div class="ui-layer" id="hud-layer" style="justify-content: flex-start; pointer-events: none; opacity: 0;">
        <div class="hud">
            <div class="score-pill">üèÜ <span id="score">0</span></div>
            <div class="score-pill" style="font-size: 14px; opacity: 0.8;">BEST: <span id="highScore">0</span></div>
        </div>
    </div>

    <div class="ui-layer">
        <div id="start-screen" class="screen">
            <h1>TEAM <span>RUN</span></h1>
            <p>–î–æ–±–µ—Ä–∏—Å—å –¥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –≤–æ–≤—Ä–µ–º—è! –ò–∑–±–µ–≥–∞–π –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π.</p>
            <button class="btn" id="startBtn">–ü–æ–≥–Ω–∞–ª–∏</button>
            <div class="footer-info">Tap to Jump ‚Ä¢ Ver 2.0</div>
        </div>
    </div>

    <div class="ui-layer">
        <div id="game-over-screen" class="screen hidden">
            <h1 style="font-size: 24px;">–û–π, –æ–ø–æ–∑–¥–∞–ª!</h1>
            <p style="margin-bottom: 10px;">–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</p>
            <span class="big-score" id="final-score">0</span>
            <button class="btn" id="restartBtn">–ï—â–µ —Ä–∞–∑</button>
        </div>
    </div>
</div>

<script>
    /* --- –ù–ê–°–¢–†–û–ô–ö–ò --- */
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const wrapper = document.getElementById('game-wrapper');

    // UI
    const scoreEl = document.getElementById('score');
    const highScoreEl = document.getElementById('highScore');
    const finalScoreEl = document.getElementById('final-score');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const hudLayer = document.getElementById('hud-layer');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let state = {
        running: false,
        speed: 6,
        score: 0,
        highScore: localStorage.getItem('teamCityRunHI') || 0,
        frames: 0,
        groundY: 0
    };

    // --- –†–ï–°–ê–ô–ó ---
    function resize() {
        canvas.width = wrapper.offsetWidth;
        canvas.height = wrapper.offsetHeight;
        state.groundY = canvas.height - 80; // –ó–µ–º–ª—è –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ
    }
    window.addEventListener('resize', resize);
    resize();

    // --- –û–ë–™–ï–ö–¢–´ ---

    // 1. –ß–ê–°–¢–ò–¶–´ (–ü–´–õ–¨ –ü–†–ò –ü–†–´–ñ–ö–ï)
    const particles = [];
    class Particle {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.size = Math.random() * 5 + 2;
            this.speedX = Math.random() * 2 - 1;
            this.speedY = Math.random() * -2 - 1;
            this.color = `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.2})`;
            this.life = 1; // –ñ–∏–∑–Ω—å –æ—Ç 1 –¥–æ 0
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.life -= 0.05;
            this.size *= 0.95;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }
    function spawnDust(x, y) {
        for(let i=0; i<5; i++) particles.push(new Particle(x, y));
    }

    // 2. –§–û–ù (–ü–ê–†–ê–õ–õ–ê–ö–° –ì–û–†–û–î)
    const bgBuildings = [];
    class Building {
        constructor() {
            this.w = Math.random() * 50 + 30;
            this.h = Math.random() * 150 + 50; // –í—ã—Å–æ—Ç–∞ –∑–¥–∞–Ω–∏–π
            this.x = canvas.width + Math.random() * 100;
            this.y = state.groundY - this.h;
            // –†–∞–∑–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ –¥–ª—è –≥–ª—É–±–∏–Ω—ã
            const shade = Math.floor(Math.random() * 50) + 200; 
            this.color = `rgba(255, 255, 255, 0.15)`; // –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –±–µ–ª—ã–µ —Å–∏–ª—É—ç—Ç—ã
        }
        update() {
            this.x -= state.speed * 0.3; // –î–≤–∏–≥–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ
            if(this.x + this.w < 0) {
                this.x = canvas.width + Math.random() * 50;
                this.h = Math.random() * 200 + 50;
                this.y = state.groundY - this.h;
            }
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.w, this.h);
            // –û–∫–æ—à–∫–∏
            ctx.fillStyle = "rgba(255,255,255,0.1)";
            for(let iy = this.y + 10; iy < state.groundY; iy += 20) {
                if(Math.random() > 0.5) ctx.fillRect(this.x + 5, iy, this.w - 10, 10);
            }
        }
    }
    // –ó–∞–ø–æ–ª–Ω–∏–º –≥–æ—Ä–æ–¥
    for(let i=0; i<6; i++) bgBuildings.push(new Building());


    // 3. –ì–ï–†–û–ô (–°—Ç—É–¥–µ–Ω—Ç)
    const hero = {
        x: 40,
        y: 0,
        w: 30,
        h: 50,
        dy: 0,
        jumpForce: 13, // –°–∏–ª–∞ –ø—Ä—ã–∂–∫–∞
        gravity: 0.65,
        grounded: false,
        legAnim: 0,

        draw: function() {
            // –†–∏—Å—É–µ–º —á–µ–ª–æ–≤–µ—á–∫–∞ –∫–æ–¥–æ–º
            const x = this.x;
            const y = this.y;
            
            ctx.save();
            
            // –¢–µ–Ω—å
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.beginPath();
            ctx.ellipse(x + 15, y + 50, 15, 5, 0, 0, Math.PI * 2);
            ctx.fill();

            // –ù–æ–≥–∏ (–ê–Ω–∏–º–∞—Ü–∏—è –±–µ–≥–∞)
            ctx.fillStyle = "#333";
            const legOffset = Math.sin(this.legAnim) * 10;
            if(this.grounded) {
                ctx.fillRect(x + 5, y + 35, 8, 15 + legOffset); // –õ–µ–≤–∞—è
                ctx.fillRect(x + 18, y + 35, 8, 15 - legOffset); // –ü—Ä–∞–≤–∞—è
            } else {
                // –ü–æ–∑–∞ –ø—Ä—ã–∂–∫–∞
                ctx.fillRect(x + 5, y + 35, 8, 10);
                ctx.fillRect(x + 18, y + 30, 8, 10);
            }

            // –¢–µ–ª–æ (–§—É—Ç–±–æ–ª–∫–∞)
            ctx.fillStyle = "#FF4B2B"; // –û—Ä–∞–Ω–∂–µ–≤–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞
            ctx.fillRect(x, y + 15, 30, 25);
            
            // –†—é–∫–∑–∞–∫
            ctx.fillStyle = "#2B32B2"; // –°–∏–Ω–∏–π —Ä—é–∫–∑–∞–∫
            ctx.fillRect(x - 8, y + 18, 8, 20);

            // –ì–æ–ª–æ–≤–∞
            ctx.fillStyle = "#f1c27d"; // –ö–æ–∂–∞
            ctx.beginPath();
            ctx.arc(x + 15, y + 10, 12, 0, Math.PI*2);
            ctx.fill();

            // –ö–µ–ø–∫–∞/–í–æ–ª–æ—Å—ã
            ctx.fillStyle = "#333";
            ctx.beginPath();
            ctx.arc(x + 15, y + 8, 12, Math.PI, 0); // –®–∞–ø–∫–∞
            ctx.fill();
            ctx.fillRect(x+15, y+5, 15, 4); // –ö–æ–∑—ã—Ä–µ–∫

            ctx.restore();
        },

        update: function() {
            // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
            this.dy += this.gravity;
            this.y += this.dy;

            // –ó–µ–º–ª—è
            if (this.y + this.h > state.groundY) {
                if(!this.grounded) {
                    spawnDust(this.x + 15, state.groundY); // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏—è
                }
                this.y = state.groundY - this.h;
                this.dy = 0;
                this.grounded = true;
            } else {
                this.grounded = false;
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–æ–≥
            if(state.running) this.legAnim += 0.3;
        },

        jump: function() {
            if (this.grounded) {
                this.dy = -this.jumpForce;
                this.grounded = false;
                spawnDust(this.x + 15, state.groundY); // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä—ã–∂–∫–∞
            }
        }
    };

    // 4. –ü–†–ï–ü–Ø–¢–°–¢–í–ò–Ø
    const obstacles = [];
    let obsTimer = 0;

    class Obstacle {
        constructor() {
            this.w = 40;
            this.h = 40 + Math.random() * 30; // –†–∞–∑–Ω–∞—è –≤—ã—Å–æ—Ç–∞
            this.x = canvas.width;
            this.y = state.groundY - this.h;
            this.markedForDeletion = false;
            this.type = Math.random() > 0.5 ? 'box' : 'barrier';
        }

        update() {
            this.x -= state.speed;
            if (this.x + this.w < 0) {
                this.markedForDeletion = true;
                state.score++;
                scoreEl.innerText = state.score;
                
                // –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏–≥—Ä—ã
                if (state.score % 10 === 0) state.speed += 0.2;
            }
        }

        draw() {
            const x = this.x;
            const y = this.y;
            const w = this.w;
            const h = this.h;

            // –†–∏—Å—É–µ–º —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –∫–æ—Ä–æ–±–∫—É/—è—â–∏–∫
            ctx.fillStyle = "#E65100"; // –¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π
            ctx.fillRect(x, y, w, h);
            
            // –î–µ—Ç–∞–ª–∏ (–∫—Ä–µ—Å—Ç –∏–ª–∏ –ø–æ–ª–æ—Å–∫–∏)
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.fillRect(x + 5, y + 5, w - 10, h - 10);
            
            // –ó–Ω–∞–∫ "–û–ø–∞—Å–Ω–æ" (–ø–æ–ª–æ—Å–∫–∏)
            ctx.fillStyle = "#FFD600";
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x+10, y);
            ctx.lineTo(x, y+10);
            ctx.fill();
        }
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---

    function resetGame() {
        state.running = true;
        state.score = 0;
        state.speed = 6;
        state.frames = 0;
        
        obstacles.length = 0;
        particles.length = 0;
        hero.y = state.groundY - hero.h;
        hero.dy = 0;

        scoreEl.innerText = "0";
        highScoreEl.innerText = state.highScore;

        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        hudLayer.style.opacity = 1;
        
        wrapper.classList.remove('shake');
        
        loop();
    }

    function gameOver() {
        state.running = false;
        
        // –í–∏–±—Ä–∞—Ü–∏—è –∏ —Ç—Ä—è—Å–∫–∞
        if(navigator.vibrate) navigator.vibrate(200);
        wrapper.classList.add('shake');

        if(state.score > state.highScore) {
            state.highScore = state.score;
            localStorage.setItem('teamCityRunHI', state.highScore);
        }
        
        finalScoreEl.innerText = state.score;
        hudLayer.style.opacity = 0;
        
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –º–µ–Ω—é
        setTimeout(() => {
            gameOverScreen.classList.remove('hidden');
        }, 500);
    }

    function loop() {
        if(!state.running) return;

        // –û—á–∏—Å—Ç–∫–∞
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. –†–∏—Å—É–µ–º —Ñ–æ–Ω (–ù–µ–±–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç —É–∂–µ –≤ CSS, –∑–¥–µ—Å—å —Ä–∏—Å—É–µ–º –≥–æ—Ä–æ–¥)
        bgBuildings.forEach(b => { b.update(); b.draw(); });

        // 2. –†–∏—Å—É–µ–º –¥–æ—Ä–æ–≥—É
        ctx.fillStyle = "#37474F"; // –ê—Å—Ñ–∞–ª—å—Ç
        ctx.fillRect(0, state.groundY, canvas.width, canvas.height - state.groundY);
        // –ü–æ–ª–æ—Å–∞ –Ω–∞ –¥–æ—Ä–æ–≥–µ
        ctx.fillStyle = "#FFF"; 
        ctx.globalAlpha = 0.5;
        state.frames++;
        const dashOffset = (state.frames * state.speed) % 40;
        for(let i = -40; i < canvas.width; i+=40) {
            ctx.fillRect(i - dashOffset, state.groundY + 20, 20, 4);
        }
        ctx.globalAlpha = 1.0;

        // 3. –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        obsTimer++;
        // –†–∞–Ω–¥–æ–º–Ω—ã–π —Å–ø–∞–≤–Ω
        let spawnRate = 100 - (state.speed * 2); 
        if(spawnRate < 40) spawnRate = 40;

        if (obsTimer > spawnRate + Math.random() * 60) {
            obstacles.push(new Obstacle());
            obsTimer = 0;
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let ob = obstacles[i];
            ob.update();
            ob.draw();

            // –ö–æ–ª–ª–∏–∑–∏—è (–ø—Ä–æ—Å—Ç–∞—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è)
            // –ß—É—Ç—å —É–º–µ–Ω—å—à–∞–µ–º —Ö–∏—Ç–±–æ–∫—Å –≥–µ—Ä–æ—è –¥–ª—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏
            if (
                hero.x + 5 < ob.x + ob.w &&
                hero.x + hero.w - 5 > ob.x &&
                hero.y + 5 < ob.y + ob.h &&
                hero.y + hero.h > ob.y
            ) {
                gameOver();
            }

            if (ob.markedForDeletion) obstacles.splice(i, 1);
        }

        // 4. –ì–µ—Ä–æ–π
        hero.update();
        hero.draw();

        // 5. –ß–∞—Å—Ç–∏—Ü—ã
        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update();
            particles[i].draw();
            if(particles[i].life <= 0) particles.splice(i, 1);
        }

        requestAnimationFrame(loop);
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
    function action(e) {
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–∑—É–º, —Å–∫—Ä–æ–ª–ª)
        if(e.cancelable && e.type !== 'click') e.preventDefault(); 
        
        if(state.running) {
            hero.jump();
        }
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏
    window.addEventListener('keydown', (e) => {
        if(e.code === 'Space') action(e);
    });
    
    // –¢–∞—á –∑–æ–Ω–∞ - –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    wrapper.addEventListener('touchstart', action, {passive: false});
    wrapper.addEventListener('mousedown', action);

    // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
    startBtn.addEventListener('click', (e) => {
        e.stopPropagation(); // –ß—Ç–æ–±—ã –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–µ –≤—ã–∑–≤–∞–ª –ø—Ä—ã–∂–æ–∫ —Å—Ä–∞–∑—É
        resetGame();
    });
    restartBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        resetGame();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è High Score
    highScoreEl.innerText = state.highScore;

</script>
</body>
</html>
